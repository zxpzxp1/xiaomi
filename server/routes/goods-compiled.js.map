{"version":3,"sources":["goods.js"],"names":[],"mappings":"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","file":"goods-compiled.js","sourcesContent":["/**\n * Created by ccb on 2018/3/12.\n */\nvar express = require('express');\nvar router = express.Router();\nvar mongoose = require('mongoose');\nvar Goods = require('../models/goods');\n\nmongoose.Promise=global.Promise;\n//连接MongoDB数据库\nmongoose.connect('mongodb://127.0.0.1:27017/test');\n\nmongoose.connection.on(\"connected\", function () {\n  console.log(\"MongoDB connected success.\")\n});\nmongoose.connection.on(\"error\", function () {\n  console.log(\"MongoDB connected fail.\")\n});\n\nmongoose.connection.on(\"disconnected\", function () {\n  console.log(\"MongoDB connected disconnected.\")\n});\n\n //Goods.create({productId:'1',productName:39,salePrice:200,productNum:1,productImage:'1.jpg'},function(err,doc){\n //\t   if(!err){console.log(doc)}else\n //\t   \t{console.log(err)}\n //})\n\nrouter.get(\"/\", function (req,res,next) {\n     let sort=req.param(\"sort\");\n     let page = parseInt(req.param(\"page\"));\n     let pageSize=parseInt(req.param(\"pageSize\"));\n     let priceLevel=req.param(\"priceLevel\");\n     var priceGt = '',priceLte = '';\n     let skip=(page-1)*pageSize;\n     let params = {};\n     if(priceLevel!='all'){\n     switch (priceLevel){\n         case '0':priceGt = 0;priceLte=100;break;\n         case '1':priceGt = 100;priceLte=500;break;\n         case '2':priceGt = 500;priceLte=1000;break;\n         case '3':priceGt = 1000;priceLte=5000;break;\n     }\n     params={\n       salePrice:{\n            $gt:priceGt,\n            $lte:priceLte\n       }\n       }\n     }\n     console.log(\"params\",params);\n     let goodsModel=Goods.find(params).skip(skip).limit(pageSize);\n     goodsModel.sort({'salePrice':sort});\n     goodsModel.exec(function (err,doc) {\n       console.log('doc',doc);\n     if(err){\n      res.json({\n        status:'1',\n        msg:err.message\n      });\n     }else{\n      res.json({\n        status:'0',\n        msg:'',\n        result:{\n          count:doc.length,\n          list:doc\n        }\n      });\n    }\n    })\n\n\n\n});\n//加入到购物车\nrouter.post(\"/addCart\",function(req,res,next){\n  var userId = '100000077',productId = req.body.productId;\n  var User = require('../models/users');\n  User.findOne({userId:userId},function(err,userDoc){\n       if(err){\n         res.json({\n           status:\"1\",\n           msg:err.message\n         })\n       }else\n       {\n         if(userDoc){\n           var goodsItem = '';\n           userDoc.cartList.forEach(function (item) {\n             if(item.productId == productId){\n               goodsItem = item;\n               item.productNum ++;\n             }\n           });\n           if(goodsItem){\n             userDoc.save(function (err2,doc2) {\n               if(err2){\n                 res.json({\n                   status:\"1\",\n                   msg:err2.message\n                 })\n               }else{\n                 res.json({\n                   status:'0',\n                   msg:'',\n                   result:'suc'\n                 })\n               }\n             })\n           }else{\n             Goods.findOne({productId:productId}, function (err1,doc) {\n               if(err1){\n                 res.json({\n                   status:\"1\",\n                   msg:err1.message\n                 })\n               }else{\n                 if(doc){\n                   doc.productNum = 1;\n                   doc.checked = 1;\n                   userDoc.cartList.push(doc);\n                   userDoc.save(function (err2,doc2) {\n                     if(err2){\n                       res.json({\n                         status:\"1\",\n                         msg:err2.message\n                       })\n                     }else{\n                       res.json({\n                         status:'0',\n                         msg:'',\n                         result:'suc'\n                       })\n                     }\n                   })\n                 }\n               }\n             });\n           }\n         }\n       }\n  })\n});\nmodule.exports = router;\n"]}