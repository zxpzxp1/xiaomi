{"version":3,"sources":["users.js"],"names":[],"mappings":"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","file":"users-compiled.js","sourcesContent":["var express = require('express');\nvar router = express.Router();\nvar mongoose = require('mongoose');\nvar Users = require('../models/users');\nrequire('./../util/util');\n\n\nmongoose.connection.on(\"connected\", function () {\n  console.log(\"MongoDB connected success.\")\n});\nmongoose.connection.on(\"error\", function () {\n  console.log(\"MongoDB connected fail.\")\n});\n\nmongoose.connection.on(\"disconnected\", function () {\n  console.log(\"MongoDB connected disconnected.\")\n});\n/* GET users listing. */\nrouter.get('/', function(req, res, next) {\n  res.send('respond with a resource');\n});\nrouter.get('/test', function(req, res, next) {\n  res.send('test');\n});\nrouter.post('/login', function(req, res, next) {\n  var param={userName:req.body.userName,userPwd:req.body.userPwd};\n  Users.findOne(\n    param,function(err,doc){\n           if(err)\n           {\n               res.json({\n               status:'1',\n               msg:err.message\n             });\n           }else\n           {\n                if(doc){\n                  res.cookie(\"userId\",doc.userId,{\n                    path:'/',\n                    maxAge:1000*60*60\n                  });\n                  res.cookie(\"userName\",doc.userName,{\n                    path:'/',\n                    maxAge:1000*60*60\n                  });\n             //     req.session.user=doc;\n                  res.json({\n                    status:'0',\n                    msg:'',\n                    result:{\n                      userName:doc.userName\n                    }\n                  });\n                }else\n                {\n                  res.json({\n                    status:'1',\n                    msg:'账号密码错误',\n                    result:''\n                  });\n\n                }\n           }\n    }\n  )\n});\n//登出\nrouter.post('/loginOut',function(req,res,next){\n  res.cookie(\"userId\",'',{\n       path:'/',\n       maxAge:-1\n  });\n  res.cookie(\"userName\",'',{\n    path:'/',\n    maxAge:-1\n  });\n  res.json({status:'0',\n            msg:'',\n            result:''});\n})\nrouter.get(\"/checkLogin\", function (req,res,next) {\n  if(req.cookies.userId){\n    res.json({\n      status:'0',\n      msg:'',\n      result:req.cookies.userName || ''\n    });\n  }else{\n    res.json({\n      status:'1',\n      msg:'未登录',\n      result:''\n    });\n  }\n});\n//查询当前用户的购物车数据\nrouter.get('/cartList',function(req,res,next)\n{\n   var userId=req.cookies.userId;\n    Users.findOne(\n    {userId:userId},function(err,doc){\n        if(err)\n        {\n          res.json({\n            status:'1',\n            msg:err.message\n          });\n        }else\n        {\n            if(doc) {\n              res.json({status:'0',msg:'',result:doc.cartList})\n            }\n\n        }\n    }\n\n  )\n})\n//购物车删除\nrouter.post('/cartDel',function(req,res,next)\n{\n       var userId=req.cookies.userId;\n       var productId=req.body.productId;\n       Users.update({'userId':userId},\n         {$pull:{'cartList':{\n            'productId':productId\n           }\n         }\n         },function(err,doc){\n         if(err) {\n           res.json({\n             status:'1',\n             msg:err.message\n           });\n         }else\n         {\n           if(doc) {\n             res.json({status:'0',msg:'',result:\"\"})\n           }\n         }\n         });\n});\n//修改商品数量\nrouter.post(\"/cartEdit\", function (req,res,next){\n       var userId=req.cookies.userId;\n       var productId=req.body.productId;\n       var productNum = req.body.productNum;\n       var checked = req.body.checked;\n       Users.update({\"userId\":userId,\"cartList.productId\":productId},\n         {\"cartList.$.productNum\":productNum,\"cartList.$.checked\":checked},function(err,doc)\n         {\n           if(err) {\n             res.json({\n               status:'1',\n               msg:err.message\n             });\n           }else\n           {\n              if(doc) {\n               res.json({status:'0',msg:'',result:\"\"})\n             }\n           }\n         });\n});\n//地址列表\nrouter.get('/addressList',function(req,res,next){\n        var userId=req.cookies.userId;\n        Users.findOne({'userId':userId},function(err,doc)\n        {\n          if(err) {\n            res.json({\n              status:'1',\n              msg:err.message\n            });}else\n          {\n            res.json({\n                status:'0',\n                result:doc.addressList,\n                msg:''\n            })\n          }\n\n        })\n});\n//设置缺省值\nrouter.post('/setDefault',function(req,res,next){\n       var userId=req.cookies.userId;\n       var addressId=req.body.addressId;\n       Users.findOne({'userId':userId},function(err,doc)\n       {\n        if(err) {\n           res.json({\n           status:'1',\n           msg:err.message\n         });}else\n       {\n           var addressList = doc.addressList;\n           addressList.forEach((item)=>{\n                   if(item.addressId==addressId)\n                   {\n                      item.isDefault=true\n                   }else\n                   {\n                     item.isDefault=false\n                   }\n           })\n      }\n         doc.save(function(err1,doc1){\n           if(err1){\n             res.json({\n               status:'1',\n               msg:err.message,\n               result:''\n             });\n           }else{\n             res.json({\n               status:'0',\n               msg:'',\n               result:''\n             });\n           }\n         });\n  })\n});\n//删除地址列表\nrouter.post('/delAddress',function(req,res,next){\n  var userId=req.cookies.userId;\n  var addressId=req.body.addressId;\n  Users.update({'userId':userId},\n    {$pull:{'addressList':{\n      'addressId':addressId\n    }\n    }\n    },function(err,doc){\n      if(err) {\n        res.json({\n          status:'1',\n          msg:err.message\n        });\n      }else\n      {\n        if(doc) {\n          res.json({status:'0',msg:'',result:\"\"})\n        }\n      }\n    });\n});\n//订单支付\nrouter.post(\"/payMent\",function(req,res,next){\n          var userId=req.cookies.userId;\n          var orderTotal=req.body.orderTotal;\n          var addressId = req.body.addressId;\n          Users.findOne(\n            {userId:userId},function(err,doc){\n              if(err) {\n                res.json({\n                  status:'1',\n                  msg:err.message\n                });\n              }else\n              {\n                  var address = '',goodsList = [];\n                 //获取地址信息\n                 doc.addressList.forEach((item)=>{\n                     if(item.addressId==addressId)\n                     {\n                       address=item;\n                     }\n                 })\n                //获取用户购物车的购买商品\n                doc.cartList.filter((item)=>{\n                    item.checked='1';\n                    goodsList.push(item);\n                })\n                var platform = '622';\n                var r1 = Math.floor(Math.random()*10);\n                var r2 = Math.floor(Math.random()*10);\n                var sysDate = new Date().Format('yyyyMMddhhmmss');\n                var createDate = new Date().Format('yyyy-MM-dd hh:mm:ss');\n                var orderId = platform+r1+sysDate+r2;\n                var order = {\n                  orderId:orderId,\n                  orderTotal:orderTotal,\n                  addressInfo:address,\n                  goodsList:goodsList,\n                  orderStatus:'1',\n                  createDate:createDate\n                };\n                doc.orderList.push(order);\n                doc.save(function (err1,doc1) {\n                  if(err1){\n                    res.json({\n                      status:\"1\",\n                      msg:err.message,\n                      result:''\n                    });\n                  }else{\n                    res.json({\n                      status:\"0\",\n                      msg:'',\n                      result:{\n                        orderId:order.orderId,\n                        orderTotal:order.orderTotal\n                      }\n                    });\n                  }\n                });\n\n              }\n\n            }\n\n          )\n\n\n})\n//查询订单信息\nrouter.get('/orderDetail',function(req,res,next){\n  var userId=req.cookies.userId;\n  var orderId=req.param(\"orderId\");\n  Users.findOne({'userId':userId},function(err,doc)\n  {\n    if(err) {\n      res.json({\n        status:'1',\n        msg:err.message\n      });}else\n      {\n         var  orderList=doc.orderList;\n         if(orderList.length>0)\n         {\n           var orderTotal = 0;\n           orderList.forEach((item)=>{\n             if(item.orderId == orderId){\n               orderTotal = item.orderTotal;\n             }\n           });\n            res.json({\n              status:\"0\",\n              msg:'',\n              result:{\n                orderId:orderId,\n                orderTotal:orderTotal\n              }\n            })\n         }else\n         {\n           res.json({\n             status:\"0\",\n             msg:'',\n             result:'无此订单'\n           })\n\n\n         }\n\n\n      }\n  })\n});\n//查询购物车数量\nrouter.get(\"/getCartCount\", function (req,res,next) {\n  if(req.cookies && req.cookies.userId){\n    console.log(\"userId:\"+req.cookies.userId);\n    var userId = req.cookies.userId;\n    Users.findOne({\"userId\":userId}, function (err,doc) {\n      if(err){\n        res.json({\n          status:\"0\",\n          msg:err.message\n        });\n      }else{\n        let cartList = doc.cartList;\n        let cartCount = 0;\n        cartList.map(function(item){\n          cartCount += parseFloat(item.productNum);\n        });\n        res.json({\n          status:\"0\",\n          msg:\"\",\n          result:cartCount\n        });\n      }\n    });\n  }else{\n    res.json({\n      status:\"0\",\n      msg:\"当前用户不存在\"\n    });\n  }\n});\nmodule.exports = router;\n"]}